import { PrismaClient } from "@prisma/client";
import { Router } from "express";
import requireUser from "../middleware/requireUser";
import { authorize } from "../middleware/authorize";
import {
  addIndent,
  addIndentRemark,
  deleteIndent,
  editIndentRemark,
  exportIndentsExcel,
  getIndentAuditTrailController,
  getIndentRepo,
  getIndents,
  updateIndent,
} from "../controllers/indentManagement/indentController";
import { PERMISSIONS } from "../constants/permissions";
import { getNotificationIndent } from "../controllers/indentManagement/notificationController";

const prisma = new PrismaClient();

export const indentRouter = Router();

//Fetch all indents
indentRouter.get(
  "/:role/:tab/:department?",
  requireUser,
  authorize([PERMISSIONS.IBA]),
  getIndents
);
//create a new indent
indentRouter.post(
  "/",
  requireUser,
  authorize([PERMISSIONS.COMPLIANCE_MAKER]),
  addIndent
);

// delete a indent
indentRouter.delete(
  "/:indentId",
  requireUser,
  authorize([PERMISSIONS.COMPLIANCE_MAKER]),
  deleteIndent
);

//update a indent
indentRouter.put(
  "/:role/:department/:indentId",
  requireUser,
  authorize([PERMISSIONS.IBA]),
  updateIndent
);

// crete a new Indent Remark
indentRouter.post(
  "/remarks/:indentId",
  requireUser,
  authorize([PERMISSIONS.IBA]),
  addIndentRemark
);

// edit a indent Remark
indentRouter.put(
  "/remarks/:remarkId",
  requireUser,
  authorize([PERMISSIONS.IBA]),
  editIndentRemark
);

//Get Indent Repository with filters and search
indentRouter.get(
  "/repository",
  requireUser,
  authorize([PERMISSIONS.IBA]),
  getIndentRepo
);

// Notification endpoint
indentRouter.get(
  "/notifications",
  requireUser,
  authorize([PERMISSIONS.IBA]),
  getNotificationIndent
);

// audit-trail endpoint
indentRouter.get(
  "/audit-trail",
  requireUser,
  authorize([PERMISSIONS.CLOSURE_ACCESS]),
  getIndentAuditTrailController
);

indentRouter.get(
  "/export/excel",
  requireUser,
  authorize([PERMISSIONS.IBA]),
  exportIndentsExcel
);

Incoming request: GET /api/v1/indents/export/excel?
