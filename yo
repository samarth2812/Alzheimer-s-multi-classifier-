import { prisma } from "@/lib/prisma"; // adjust based on your project structure
import { AuditAction, StepRoles } from "@prisma/client";

export const createIndentAuditTrail = async ({
  indentId,
  actionType,
  step,
  role,
  performedByName,
  performedByEmail,
  fieldChanges,
  workflowChanges,
  attachmentChanges,
}: {
  indentId: string;
  actionType: AuditAction;
  step: number;
  role: StepRoles;
  performedByName: string;
  performedByEmail: string;
  fieldChanges?: Record<string, { from: any; to: any }>;
  workflowChanges?: { fromStep: number; toStep: number; rejectionReason?: string };
  attachmentChanges?: { added?: string[]; deleted?: string[] };
}) => {
  try {
    await prisma.indentAuditTrail.create({
      data: {
        indentId,
        actionType,
        step,
        role,
        performedByName,
        performedByEmail,
        fieldChanges: fieldChanges ?? undefined,
        workflowChanges: workflowChanges ?? undefined,
        attachmentChanges: attachmentChanges ?? undefined,
      },
    });
  } catch (error) {
    console.error("Failed to create indent audit trail:", error);
    throw new Error("Audit trail creation failed");
  }
};
