    const key = `${moduleName}/${entityId}/${uploadedByRole}/${timestamp}_${cleanFileName}`;
    const params = {
      Bucket: process.env.AWS_S3_BUCKET!,
      Key: key,
      Body: file.buffer,
      ContentType: file.mimetype,
    };

    // Uploading to S3
    await s3.putObject(params).promise();

    // Creating attachment Record
    const attachment = await prisma.attachment.create({
      data: {
        fileName: cleanFileName,
        uploadedBy,
        uploadedByRole,
        s3Key: key,
        moduleType: moduleName,
        moduleId: entityId,
      },
    });

    return {
      fileUrl: key,
      attachmentId: attachment.id,
    };
