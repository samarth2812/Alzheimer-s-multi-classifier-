const normalizedSearch = searchQuery?.trim().toUpperCase().replace(/\s+/g, "_");

const matchingDepartments = Object.values(Department).filter((dept) =>
  dept.includes(normalizedSearch || "")
);

const matchingCategories = Object.values(IndentCategory).filter((cat) =>
  cat.includes(normalizedSearch || "")
);

const where: Prisma.IndentsWhereInput = {
  ...generateWhereFilter(role, department, tab, user.email),
  ...(searchQuery && {
    OR: [
      ...(matchingDepartments.length > 0
        ? [
            {
              department: {
                in: matchingDepartments,
              },
            },
          ]
        : []),
      ...(matchingCategories.length > 0
        ? [
            {
              category: {
                in: matchingCategories,
              },
            },
          ]
        : []),
      {
        assignedTo: {
          contains: searchQuery,
          mode: "insensitive",
        },
      },
    ],
  }),
};
